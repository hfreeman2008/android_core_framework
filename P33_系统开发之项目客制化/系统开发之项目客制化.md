# P33: 系统开发之项目客制化

<img src="../flower/flower_p23.png">

---

[跳转到readme](https://github.com/hfreeman2008/android_core_framework/blob/main/README-CN.md)


---

[<font face='黑体' color=#ff0000 size=40 >跳转到文章结尾</font>](#结束语)

---

[上一篇文章 P32_系统开发之IMS输入模块](https://github.com/hfreeman2008/android_core_framework/blob/main/P32_%E7%B3%BB%E7%BB%9F%E5%BC%80%E5%8F%91%E4%B9%8BIMS%E8%BE%93%E5%85%A5%E6%A8%A1%E5%9D%97/%E7%B3%BB%E7%BB%9F%E5%BC%80%E5%8F%91%E4%B9%8BIMS%E8%BE%93%E5%85%A5%E6%A8%A1%E5%9D%97.md)






---


# 新建项目的步骤和说明


以新建一个i7s项目为例：

(1)添加lunch选择项目类型

device\qcom\common\vendorsetup.sh

```sh
add_lunch_combo i7s-user
add_lunch_combo i7s-userdebug
add_lunch_combo i7s-eng
```

(2)添加项目列表

vendor\qcom\proprietary\common\config\device-vendor.mk

```sh
PRODUCT_LIST += i7s
```

 (3) 对比当前项目名，新建一个i7s目录

device\qcom\i7s
 
然后对应来修改相关的信息。 

---

# 复制方式实现项目overlay

## 添加项目源代码的直接复制覆盖功能

build\make\overlay_codes_copy_hytera.sh

```sh
#!/bin/bash
#add  copy codes for different projects 2024_8_14 start
function copy() {
    local src=$1
    local des=$2
    echo "overlay_codes_copy_hytera.sh copy src : $src"
    echo "overlay_codes_copy_hytera.sh copy des : $des"
    if [ -d ${src} -a -d ${des} ]; then
        echo "cp -rf ${src}* ${des}"
        cp -rf ${src}* ${des}
    fi
}
function main()
{
    echo "*******do overlay codes copy hytera start********"
    echo "overlay_codes_copy_hytera.sh main src : $1"
    echo "overlay_codes_copy_hytera.sh main des : $2"
    copy $1 $2
    echo "*******do overlay codes copy hytera end********"
}
main $1 $2
#add  copy codes for different projects 2024_8_14 end
```
这个文件执行：

```sh
chmod 777 overlay_codes_copy_hytera.sh
```


build\make\envsetup.sh

```sh
function lunch()
{
.......    
    echo
    #add  copy codes for different projects 2024_8_14 start
    #local local_path=$PWD
    local local_path=`/bin/pwd`
    echo "local_path: $local_path"
    local overlay_codes_copy_file=$local_path/build/make/overlay_codes_copy_hytera.sh
    if [ -e $overlay_codes_copy_file ];then
        echo "$overlay_codes_copy_file file exist,copy file for different projects !!!!"
        echo "MOBILE_POLICE_VALUE $MOBILE_POLICE_VALUE"
        if [ $MOBILE_POLICE_VALUE = MOBILE_POLICE_VERSION ];then
            echo "mobile police project,copy cods"
            local mobile_police_src_file=$local_path/vendor/mobile_police/overlay_codes/
            echo "mobile_police_src_file $mobile_police_src_file"
            $overlay_codes_copy_file $mobile_police_src_file $local_path/
            ##. $overlay_codes_copy_file $mobile_police_src_file $local_path/
        fi
    else
        echo "$overlay_codes_copy_file file no exist!!!!"
    fi
    #add  copy codes for different projects 2024_8_14 end
    set_stuff_for_environment
    printconfig
    destroy_build_var_cache
}
```

对应的要客制化的源代码的位置为：

```sh
vendor\mobile_police\overlay_codes
```


---

## 复制具体contents.xml文件

device\qcom\i7s\non_hlos\contents.xml
 
要修改此路径为我们对应添加项目的路径:

out/target/product/i7s/
 
并且在脚本中:

在编译前复制对应项目的此文件:

copy_customer_overlay_code


```sh
 function copy_customer_overlay_code()
{
echo "copy_customer_overlay_code"
if [ -e $BUILD_AP_DIR/device/qcom/$BUILD_PROJECT_NAME/non_hlos ]; then
    chmod 777 contents.xml
    cp -rf $BUILD_AP_DIR/device/qcom/$BUILD_PROJECT_NAME/non_hlos/*   $SRC_DIR
    echo "end copy $BUILD_AP_DIR/device/qcom/$BUILD_PROJECT_NAME/non_hlos/* to SRC_DIR"
fi
}
```

---


## 直接复制文件来替换对应源码

---


```sh

```


```sh

```


```sh

```

```sh

```



---






---











---

[<font face='黑体' color=#ff0000 size=40 >跳转到文章开始</font>](#p33-系统开发之项目客制化)

---


[上一篇文章 P32_系统开发之IMS输入模块](https://github.com/hfreeman2008/android_core_framework/blob/main/P32_%E7%B3%BB%E7%BB%9F%E5%BC%80%E5%8F%91%E4%B9%8BIMS%E8%BE%93%E5%85%A5%E6%A8%A1%E5%9D%97/%E7%B3%BB%E7%BB%9F%E5%BC%80%E5%8F%91%E4%B9%8BIMS%E8%BE%93%E5%85%A5%E6%A8%A1%E5%9D%97.md)






---

# 结束语

<img src="../Images/end_001.png">