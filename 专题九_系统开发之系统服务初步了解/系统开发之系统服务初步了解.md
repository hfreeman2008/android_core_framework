# 专题九: 系统开发之系统服务初步了解

<img src="flower_one.png">



# 一个mini系统服务----ContextHubSystemService

我们先看一个系统中的原生的mini的系统服务------ContextHubSystemService

```java
package com.android.server;

import android.content.Context;
import android.util.Log;
import com.android.internal.util.ConcurrentUtils;
import com.android.server.location.ContextHubService;
import java.util.concurrent.Future;

class ContextHubSystemService extends SystemService {

    private static final String TAG = "ContextHubSystemService";
    private ContextHubService mContextHubService;

    private Future<?> mInit;

    //(1)构造方法----一般来说必要
    public ContextHubSystemService(Context context) {
        super(context);
        mInit = SystemServerInitThreadPool.submit(() -> {
            mContextHubService = new ContextHubService(context);
        }, "Init ContextHubSystemService");
    }

    //(2)重写onStart()方法----一般来说必要
    @Override
    public void onStart() {
    }

    //(3)onBootPhase()方法----一般来说必要
    @Override
    public void onBootPhase(int phase) {
        if (phase == SystemService.PHASE_SYSTEM_SERVICES_READY) {
            Log.d(TAG, "onBootPhase: PHASE_SYSTEM_SERVICES_READY");
            ConcurrentUtils.waitForFutureNoInterrupt(mInit,
                    "Wait for ContextHubSystemService init");
            mInit = null;
            publishBinderService(Context.CONTEXTHUB_SERVICE, mContextHubService);
        }
    }
}
```


可以看出，新写一个系统服务类，我们可以就写这三个方法：

- (1)构造方法----一般来说必要

- (2)重写onStart()方法----一般来说必要

- (3)onBootPhase()方法----一般来说必要


在SystemServer.java中启动ContextHubSystemService:

```java
t.traceBegin("StartContextHubSystemService");
mSystemServiceManager.startService(ContextHubSystemService.class);
t.traceEnd();
```

是不是足够简单，可以不夸张的说，就算是从深南大道上随便牵一条狗过来都可以写一个简单的系统服务。

<img src="dog.png">





# 参考资料



