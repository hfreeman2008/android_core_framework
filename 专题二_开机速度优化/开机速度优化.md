# 专题二: 开机速度优化
对于一个系统工程师来说，开机速度优化是一个必备技能，同时由于其涉及到bootloader,kernel,system,app等多个方面，对工程师来说挑战也是比较大的。


# 非首次开机速度优化

## 完整的开机流程
第一个，我们要对开机的整个流程了然于胸：

<img src=".\Image\开机流程图.png">


## 开机速度优化的刻度尺----bootprof
bootprof文件，会记录各个关键节点的开机时间戳，我们就是以此工具来定位到那个开机流程需要优化。

bootprof文件位置为：
/proc/bootprof


## kernel驱动
此部分，如果那个时间节点比较长，都是可以优化的。
我优化中，最夸张的数据是kernel部分中发了1.5秒就完成初始化了。





# 首次开机速度优化
对比第一次开机的bootprof文件(bootprof_first)和第二次开机的bootprof文件(bootprof_second),得出如下的结论和优化方向:

## 结论
首次开机的时间为75404ms，非首次开机的时间为46562ms，大概多了32秒。

## 优化方向

### dex文件耗时
首次开机的时间对比非首次开机的时间多12秒，此部分完全是新增加的时间，优化空间比较大。

优化方法：
关键字:performDexOpt, 以此为突破口，确定那个应用dex花时间比较多，考虑关闭此应用的dex。

### init进程
首次开机的时间对比非首次开机的时间多16秒，此部分没有看到明显的新增逻辑，估计没有优化空间。

重点有二个时间点需要关注：

+ mount相关,此处有6秒钟的时间:

```java
9772.402099 : 304-init : INIT:Mount_START --late
14356.829187 : 304-init : INIT:Mount_END --late
```

+ modem相关,此处有7秒钟的时间:

```java
16647.602500 : 304-init : modprobe: Load_Module_DONE
23149.843439 : 304-init : post-fs-data: on modem start
```


### 包扫描 pms

首次开机的时间对比非首次开机的时间多2秒，此部分是有一些应用会在第一次开机时会启动，后续就不会启动，估计没有优化空间。


### ActivityManager
首次开机的时间对比非首次开机的时间多4秒，此部分吗上面包扫描类似，，有一些应用只是在第一次开机起作用，后续就不启动起作用，估计没有优化空间。
这些应用有：
```java
com.android.permissioncontroller
com.android.provision
```


## 非首次开机速度优化脑图

<img src=".\Image\非首次开机速度优化脑图.png">








# 培训资料
Android开机速度优化浅析--何小明.pptx

这个是我在公司做的一个关于Android开机速度优化浅析的PPT，基本上从整体上讲透了开机速度优化的前因，中间方法，后果。

希望对大家有用。



